node {
    
    stage 'checkout'
    git 'https://github.com/afroje-reshma/spring-boot-sample.git'
    def project_path = "spring-boot-samples/spring-boot-sample-atmosphere"
    
    stage 'sonar-scan'
    def scannerHome = tool 'sonar-scanner'
    sh "${scannerHome}/bin/sonar-scanner"
    
     dir(project_path){
     withEnv(["PATH+MAVEN=${tool 'M3'}/bin"]){
     stage 'compiling, packaging'    
     sh 'mvn clean package'
     
     stage 'test-archival/HTML-verify'
     publishHTML(target: [allowMissing: true,
     alwaysLinkToLastBuild: false, 
     keepAll: true, 
     reportDir: 'target/site/jacoco',
     reportFiles: 'index.html', reportName: 'HTML Report'])
     
     step([$class: 'JUnitResultArchiver',
     testResults: 'target/surefire-reports/TEST-*.xml'])

     stage 'publish-nexus'
     
    
     step([$class: 'NexusArtifactUploader',
     artifactId: 'spring-boot-samples', classifier: 'artifact',
     credentialsId: 'b9bc9cc5-871e-4738-88f3-9c3e5525a096',
     file: '/var/lib/jenkins/workspace/atmosphere/spring-boot-samples/spring-boot-sample-atmosphere/target/spring-boot-sample-atmosphere-1.4.0.BUILD-SNAPSHOT.jar',
     groupId: 'org.springframework.boot',
     nexusUrl: '35.163.156.3:8081/nexus', 
     nexusVersion: 'NEXUS2', protocol: 'http',
     repository: 'releases', type: 'jar', version: '1.5']) 
     
     
       
     

  }

 }
}
